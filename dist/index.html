<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Jewelsback</title><style>body,html{display:flex;justify-content:center;align-items:center;margin:0;padding:0;height:100vh;font:1.15em/1.3 sans-serif;background:linear-gradient(180deg,#1e528e 0,#728a7c 50%,#e9ce5d);overflow:auto}.transitions-off{transition:none!important}@keyframes slot-selected{0%{outline-color:rgba(136,187,238,.333);outline-offset:-5px;outline-width:5px}to{outline-color:rgba(136,187,238,.467);outline-offset:-7px;outline-width:7px}}@-webkit-keyframes slot-selected{0%{outline-color:rgba(136,187,238,.333);outline-offset:-5px;outline-width:5px}to{outline-color:rgba(136,187,238,.467);outline-offset:-7px;outline-width:7px}}@keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 rgba(255,221,221,.333)}15%,25%{box-shadow:inset 0 0 200px hsla(0,0%,100%,.2),0 0 50px rgba(255,221,221,.333)}}@-webkit-keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 rgba(255,221,221,.333)}15%,25%{box-shadow:inset 0 0 200px hsla(0,0%,100%,.2),0 0 50px rgba(255,221,221,.333)}}@keyframes jewel-arriving{0%{transform:translate3d(0,-100vh,0)}to{transform:translateZ(0)}}@-webkit-keyframes jewel-arriving{0%{transform:translate3d(0,-100vh,0)}to{transform:translateZ(0)}}@keyframes jewel-falling{0%{transform:translate3d(0,-100%,0)}to{transform:translateZ(0)}}@-webkit-keyframes jewel-falling{0%{transform:translate3d(0,-100%,0)}to{transform:translateZ(0)}}@keyframes jewel-exploding{0%{opacity:1;transform:scale(1) translateY(0)}to{opacity:0;transform:scale(.25) translateY(5%)}}@-webkit-keyframes jewel-exploding{0%{opacity:1;transform:scale(1) translateY(0)}to{opacity:0;transform:scale(.25) translateY(5%)}}@keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.2)}}@-webkit-keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.2)}}@keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.9);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}@-webkit-keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.9);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}game-board{display:grid;overflow:hidden;box-sizing:border-box;width:calc(100vmin - 30px);height:calc(100vmin - 30px);border:5px solid rgba(51,51,51,.333);border-radius:10px;cursor:default;box-shadow:inset 0 5px 30px rgba(0,0,0,.467)}game-board[grabbing]{cursor:grabbing!important}game-board:not([animating]) board-slot:not(:empty){cursor:pointer!important}board-slot{position:relative;box-sizing:border-box;outline:5px solid transparent;transition:all .5s ease}board-slot:nth-child(2n){background:rgba(17,17,17,.467)}board-slot:nth-child(odd){background:rgba(0,0,0,.467)}board-slot[locked]{border:3px solid rgba(51,51,51,.333);background:transparent;cursor:default}board-slot[selected]{background:rgba(51,102,153,.467);cursor:grabbing;animation:slot-selected .3s ease-in infinite alternate forwards}board-slot[selected] jewel-piece{z-index:2}board-slot.exploding{animation:slot-exploding .3s ease both}board-slot.first-row.first-column{border-radius:4px 0 0 0}board-slot.first-row.last-column{border-radius:0 4px 0 0}board-slot.last-row.first-column{border-radius:0 0 0 4px}board-slot.last-row.last-column{border-radius:0 0 4px 0}jewel-piece{position:absolute;z-index:1;box-sizing:border-box;padding:7px;width:100%;height:100%;pointer-events:none;transform-style:preserve-3d}jewel-piece:not([hidden]){display:block}jewel-piece .border,jewel-piece .shape,jewel-piece .shape:after{box-sizing:border-box;width:100%;height:100%}jewel-piece .border{padding:2px}jewel-piece .shape{padding:15%}jewel-piece .shape:after{content:"";display:block}jewel-piece.arriving{animation:jewel-arriving .25s cubic-bezier(.25,.25,.5,1.1) forwards}jewel-piece.falling,jewel-piece.moving{transition:transform .25s cubic-bezier(.25,.25,.5,1.1)}jewel-piece.flipping{transition:transform .15s ease-in}jewel-piece.exploding{animation:jewel-exploding .25s ease-out forwards}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square]{padding:11px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{border-radius:10%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border{background:linear-gradient(130deg,#f88e86,#8d1108)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape{background:radial-gradient(#f99890,#d4190c);background:conic-gradient(from 45deg,#f55a4e,#f44336,#f33122,#f55246,#f44336,#f33628,#f55a4e,#f44336,#f33628,#f55044,#f44336,#f33122,#f65f54)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{background:linear-gradient(130deg,rgba(250,170,165,.3),rgba(250,170,165,.25))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border{background:linear-gradient(130deg,#ffe69c,#b78a00)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape{background:radial-gradient(#fd7,#c49300);background:conic-gradient(from 30deg,#ffc825,#ffc107,#f4b700,#ffc61b,#ffc107,#f9bb00,#ffc825,#ffc107,#f9bb00,#ffc518,#ffc107,#f4b700,#ffca2c)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{background:linear-gradient(130deg,rgba(255,236,181,.4),rgba(255,218,106,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle]{padding:10px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{border-radius:50%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border{background:linear-gradient(130deg,#f9ae80,#ba4c09)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape{background:radial-gradient(#f8a673,#ae4708);background:conic-gradient(from 45deg,#f4701f,#e85f0b,#d8580a,#f46914,#e85f0b,#dc5a0a,#f4701f,#e85f0b,#dc5a0a,#f46812,#e85f0b,#d8580a,#f57526)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{background:linear-gradient(130deg,rgba(248,157,102,.5),rgba(247,141,77,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{clip-path:polygon(50% 0,0 100%,100% 100%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border{background:linear-gradient(130deg,#fcecff,#9f04b9)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape{background:radial-gradient(#ee96fd,#c705e7);background:conic-gradient(from 120deg,#e457fb,#e040fb,#dc2afb,#e24ffb,#e040fb,#dd31fb,#e457fb,#e040fb,#dd31fb,#e24dfb,#e040fb,#dc2afb,#e55dfc);padding:22% 16% 11%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{background:linear-gradient(130deg,rgba(236,140,253,.5),rgba(236,140,253,.9))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{clip-path:polygon(50% 0,100% 25%,100% 75%,50% 100%,0 75%,0 25%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border{background:linear-gradient(130deg,#f3f9ed,#547928)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape{background:radial-gradient(#bfde9b,#699832);background:conic-gradient(from 45deg,#99ca60,#8bc34a,#82bc3e,#94c858,#8bc34a,#85c040,#99ca60,#8bc34a,#85c040,#93c757,#8bc34a,#82bc3e,#9ccc65)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{background:linear-gradient(130deg,rgba(209,231,183,.4),rgba(185,219,146,.55))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon]{padding:9px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{clip-path:polygon(30% 0,0 20%,0 55%,50% 100%,100% 55%,100% 20%,70% 0)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border{background:linear-gradient(130deg,#cde2fc,#09418a)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape{background:radial-gradient(#76aef6,#0b52ac);background:conic-gradient(from 45deg,#247ef1,#0f6de6,#0e65d6,#1a78f0,#0f6de6,#0e68db,#247ef1,#0f6de6,#0e68db,#1876f0,#0f6de6,#0e65d6,#2c82f1);padding:13% 15% 15%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{background:linear-gradient(130deg,rgba(155,196,249,.4),rgba(106,167,245,.55))}jewel-piece[promoted]:not(.arriving){animation:jewel-brightening .5s ease .75s infinite alternate backwards}jewel-piece[promoted]:after{position:absolute;left:50%;z-index:2;width:175%;height:175%;background-position:50%;background-size:100% 100%;content:"";transform:translate3d(-50%,0,0);pointer-events:none}jewel-piece[promoted=smoke]:after{top:-12%;width:115%;height:115%;filter:brightness(5) contrast(1.2) opacity(.5);background-image:url(smoke.eccdc0d4.webp)}jewel-piece[promoted=fire]:after{bottom:16%;left:52%;width:170%;height:140%;filter:saturate(2) brightness(1.2) contrast(1.25) opacity(1);background-image:url(fire.787f7985.webp)}jewel-piece[promoted=fire][type=heptagon]:after{bottom:26%}jewel-piece[promoted=star]:after{animation:star-blinking .85s ease .75s infinite alternate both;width:110%;height:110%;top:-5%;clip-path:polygon(50% 0,55% 45%,100% 50%,55% 55%,50% 100%,45% 55%,0 50%,45% 45%);background-image:radial-gradient(circle,hsla(0,0%,100%,.733),hsla(0,0%,100%,.133));mix-blend-mode:lighten}jewel-piece[promoted=rainbow]{padding:8px}jewel-piece[promoted=rainbow] .border,jewel-piece[promoted=rainbow] .shape,jewel-piece[promoted=rainbow] .shape:after{border-radius:0;clip-path:polygon(30% 0,70% 0,100% 30%,100% 70%,70% 100%,30% 100%,0 70%,0 30%)}jewel-piece[promoted=rainbow] .border{background:linear-gradient(98deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336);background:conic-gradient(from 90deg,hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333)),linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape{background:linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336);background:conic-gradient(from 45deg,hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.133),hsla(0,0%,100%,0),hsla(0,0%,100%,.333),hsla(0,0%,100%,.2),hsla(0,0%,100%,0),hsla(0,0%,100%,.333)),linear-gradient(90deg,#e85f0b,#ffc107,#8bc34a,#0f6de6,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape:after{background:linear-gradient(130deg,hsla(0,0%,100%,.133),hsla(0,0%,100%,.2));backdrop-filter:blur(4px)}jewel-piece[promoted=nebula] .border,jewel-piece[promoted=nebula] .shape{border-radius:50%;clip-path:none}jewel-piece[promoted=nebula] .border{background:linear-gradient(130deg,#b8c7ce,#4c636e)}jewel-piece[promoted=nebula] .shape{background:linear-gradient(130deg,#455a64,#34444b)}jewel-piece[promoted=nebula] .shape:after{display:none}jewel-piece[promoted=nebula]:after{background-image:url(smoke.eccdc0d4.webp);top:-36%;filter:brightness(0) contrast(2)}</style></head><body><main></main><script>parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"o0GU":[function(require,module,exports) {
"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,s){super(),t(this,"lastClick",null),this.x=e,this.y=s,this.addEventListener("mousedown",this.mousedown),this.addEventListener("mouseup",this.mouseup),this.addEventListener("dragstart",t=>t.preventDefault())}connectedCallback(){0===this.y&&this.classList.add("first-row"),this.y===this.board.level.size-1&&this.classList.add("last-row"),0===this.x&&this.classList.add("first-column"),this.x===this.board.level.size-1&&this.classList.add("last-column")}get locked(){return""===this.getAttribute("locked")}set locked(t){t?this.setAttribute("locked",""):this.removeAttribute("locked")}get selected(){return""===this.getAttribute("selected")}set selected(t){t?this.setAttribute("selected",""):this.removeAttribute("selected"),this.jewel&&!t&&(this.jewel.matchable=!1)}get targetable(){return""===this.getAttribute("targetable")}set targetable(t){t?this.setAttribute("targetable",""):this.removeAttribute("targetable")}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get game(){return this.board.game}get board(){return this.parentElement}get jewel(){return this.firstElementChild}set jewel(t){t.x=this.x,t.y=this.y,t.classList.remove("moving"),t.style.transform=null,this.append(t)}mousedown(){if(!this.board.animating)return this.locked?this.board.unselectAll():void(null===this.board.findJewelSelected()&&(this.board.unselectAll(),this.board.updateTargetables(this),this.board.grabbing=!0,this.selected=!0,this.lastClick=Date.now()))}mouseup(){if(!this.board.animating){if(this.board.grabbing=!1,this.locked)return this.board.unselectAll();if(this.targetable){const t=this.board.findJewelSelected();return this.board.flipJewels(this.jewel,t)}(!this.lastClick||Date.now()-this.lastClick>250)&&this.board.unselectAll()}}}exports.default=e,customElements.define("board-slot",e);
},{}],"DQ1O":[function(require,module,exports) {
"use strict";function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,r){super(),t(this,"futureSlot",null),t(this,"futurePromotion",!1),this.type=r,this.checked=!1,this.x=e.x,this.y=e.y,this.setAttribute("hidden","");const s=document.createElement("div"),i=document.createElement("div");s.className="border",this.append(s),i.className="shape",s.append(i),e.append(this)}get type(){return this.getAttribute("type")}set type(t){this.setAttribute("type",t)}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get matchable(){return""===this.getAttribute("matchable")}set matchable(t){t?this.setAttribute("matchable",""):this.removeAttribute("matchable")}get promoted(){return this.getAttribute("promoted")}set promoted(t){t?this.setAttribute("promoted",t):this.removeAttribute("promoted")}get game(){return this.board.game}get board(){return this.slot.parentElement}get slot(){return this.parentElement}get above(){return this.parentElement}get canBePromoted(){return this.matchable&&!this.promoted}generateRandomPromotion(t,e){if(t){const r=[];if(t.smoke>e.filter(t=>"smoke"===t.promoted).length&&r.push("smoke"),t.fire>e.filter(t=>"fire"===t.promoted).length&&r.push("fire"),t.star>e.filter(t=>"star"===t.promoted).length&&r.push("star"),t.rainbow>e.filter(t=>"rainbow"===t.promoted).length&&r.push("rainbow"),t.nebula>e.filter(t=>"nebula"===t.promoted).length&&r.push("nebula"),r.length>0){const e=Object.values(t).reduce((t,e)=>t+e)+this.board.level.size*(this.board.level.size/2),s=Math.floor(Math.random()*e);s<r.length&&(this.promoted=Object.values(r)[s])}}}async move(t=!0){if(this.removeAttribute("hidden"),t)this.classList.add("arriving"),await this.game.delay(250),this.classList.remove("arriving");else{const t=this.slot.getBoundingClientRect().height*(this.y+1);this.style.transform=`translate3d(0, ${-t}px, 0)`,await this.game.delay(),this.classList.add("falling"),this.style.transform=null,await this.game.delay(250),this.classList.remove("falling")}}}exports.default=e,t(e,"types",{square:"square",heptagon:"heptagon",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",circle:"circle"}),t(e,"specials",{smoke:"smoke",fire:"fire",star:"star",rainbow:"rainbow",nebula:"nebula"}),customElements.define("jewel-piece",e);
},{}],"a9lQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("./Jewel"));function e(i){return i&&i.__esModule?i:{default:i}}class t{constructor(i){this.board=i}generateUnmatchableShape(e,t,o){const s=Object.keys(i.default.types).filter(i=>i!==o),n=s[Math.random()*s.length<<0],h=this.board.findJewelByPosition(e-1,t),d=this.board.findJewelByPosition(e,t+1),a=this.board.findJewelByPosition(e-1,t+1);if(h&&d&&a&&d.type===n&&h.type===n&&a.type===n)return this.generateUnmatchableShape(e,t,n);const r=this.board.findJewelByPosition(e-2,t);if(h&&r&&h.type===n&&r.type===n)return this.generateUnmatchableShape(e,t,n);const l=this.board.findJewelByPosition(e,t+2);return d&&l&&d.type===n&&l.type===n?this.generateUnmatchableShape(e,t,n):n}checkMatchables(i,...e){for(let t of e)if(!t||i.type!==t.type)return[];return[i,...e]}findPossibleMatches(i){if(!i)return[];const e=[];if(e.push(...this.findMatchesForNebula(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForRainbow(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForStar(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForFire(i,i.canBePromoted)),e.length>0)return e;e.push(...this.findMatchesForSmoke(i,i.canBePromoted)),e.push(...this.findMatchesOfThree(i));for(let t of e)t.checked=!0;return e}findMatchesForNebula(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-3,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+3,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-3),this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2),this.board.findJewelByPosition(o,s+3))),this.promote(t,n,e,i.default.specials.nebula)}findMatchesForRainbow(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),this.promote(t,n,e,i.default.specials.rainbow)}findMatchesForStar(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1))),this.promote(t,n,e,i.default.specials.star)}findMatchesForFire(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),this.promote(t,n,e,i.default.specials.fire)}findMatchesForSmoke(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o,s-1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1))),this.promote(t,n,e,i.default.specials.smoke)}findMatchesOfThree(i){const{x:e,y:t}=i;let o=[];return o.push(...this.checkMatchables(i,this.board.findJewelByPosition(e-1,t),this.board.findJewelByPosition(e+1,t))),o.push(...this.checkMatchables(i,this.board.findJewelByPosition(e,t-1),this.board.findJewelByPosition(e,t+1))),o.filter(i=>null!==i)}promote(i,e,t,o){return e=e.filter(i=>null!==i),i&&e.length>0&&(t.futurePromotion=!0,t.promoted=o),e}}exports.default=t;
},{"./Jewel":"DQ1O"}],"1wX9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class i{constructor(i){this.board=i}findPossibleMoves(i){return i?[...this.findDirectMoves(i),...this.findIndirectMoves(i)]:[]}findDirectMoves(i){return i?[...this.findPossibleMovesTop(i),...this.findPossibleMovesRight(i),...this.findPossibleMovesBottom(i),...this.findPossibleMovesLeft(i)]:[]}findIndirectMoves(i){if(!i)return[];const e=[],{x:t,y:o}=i,s=this.board.findJewelByPosition(t,o-1),h=this.board.findJewelByPosition(t+1,o),n=this.board.findJewelByPosition(t,o+1),d=this.board.findJewelByPosition(t-1,o);return s&&e.push(...this.findPossibleMovesBottom(s,!0)),h&&e.push(...this.findPossibleMovesLeft(h,!0)),n&&e.push(...this.findPossibleMovesTop(n,!0)),d&&e.push(...this.findPossibleMovesRight(d,!0)),e}checkMatchable(i,e,t,...o){if(i.type===e.type)return null;for(let s of o)if(!s||i.type!==s.type)return null;return t?i:e}findPossibleMovesTop(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o,s-1);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o+1,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-3))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s-2),this.board.findJewelByPosition(o,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s-2),this.board.findJewelByPosition(o,s-2))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesRight(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o+1,s);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+3,s))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+1,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+2,s+1))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesBottom(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o,s+1);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+2,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-2,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o+1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o,s+2),this.board.findJewelByPosition(o,s+3))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-1,s+2),this.board.findJewelByPosition(o,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+1,s+2),this.board.findJewelByPosition(o,s+2))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesLeft(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o-1,s);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-3,s))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-1,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-2,s+1))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}}exports.default=i;
},{}],"Wb9I":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("./Slot")),t=l(require("./Jewel")),s=l(require("./MatchChecker")),i=l(require("./MoveChecker"));function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r extends HTMLElement{constructor(e){super(),o(this,"slots",[]),o(this,"level",null),o(this,"height",null),this.game=e,this.matchChecker=new s.default(this),this.moveChecker=new i.default(this),document.addEventListener("click",e=>{const t=[document.documentElement,document.body];e.target&&!t.includes(e.target)||(e.stopPropagation(),this.unselectAll())})}connectedCallback(){this.height=this.offsetHeight}get grabbing(){return""===this.getAttribute("grabbing")}set grabbing(e){e?this.setAttribute("grabbing",""):this.removeAttribute("grabbing")}get animating(){return""===this.getAttribute("animating")}set animating(e){e?this.setAttribute("animating",""):this.removeAttribute("animating")}get jewels(){return this.occupiedSlots.map(e=>e.firstChild)}get unlockedSlots(){return this.slots.filter(e=>!e.locked)}get occupiedSlots(){return this.unlockedSlots.filter(e=>e.jewel&&!e.jewel.hasAttribute("hidden"))}get emptySlots(){return this.unlockedSlots.filter(e=>!e.jewel||e.jewel.hasAttribute("hidden")||e.jewel.classList.contains("moving"))}get emptySlotsGroupedByRow(){const e=this.emptySlots.sort((e,t)=>t.y-e.y||e.x-t.x),t=new Map;return e.forEach(e=>{const s=t.get(e.y);s?s.push(e):t.set(e.y,[e])}),t}findSlotByPosition(e,t){return this.querySelector(`board-slot[x="${e}"][y="${t}"]`)}findUnlockedSlotBelow(e){return this.unlockedSlots.filter(t=>t.x===e.x&&t.y>e.y).sort((e,t)=>e.y-t.y).shift()}findJewelByPosition(e,t){return this.querySelector(`jewel-piece[x="${e}"][y="${t}"]`)}findJewelSelected(){return this.querySelector("board-slot[selected] > jewel-piece")}findJewelsBySpecial(e){return this.querySelectorAll(`jewel-piece[promoted="${e}"]`)}findJewelsPromoted(){return Array.from(this.querySelectorAll("jewel-piece[promoted]"))}unselectAll(){for(let e of this.unlockedSlots)e.targetable=!1,e.selected=!1}updateTargetables(e){const t=this.moveChecker.findPossibleMoves(e.jewel);for(let s of t)s.slot.targetable=!0}async startLevel(t){this.slots=[],this.level=t,this.style.gridTemplateColumns=this.style.gridTemplateRows=`repeat(${t.size}, 1fr)`;for(let s=0;s<t.size;s++)for(let i=0;i<t.size;i++){const l=new e.default(i,s);l.locked=t.locks.some(e=>e.x===i&&e.y===s),this.append(l),this.slots.push(l)}await this.game.delay(250),await this.fillEmptySlots()}async fillEmptySlots(e=!0){this.animating=!0;const s=this.emptySlotsGroupedByRow;for(let i of s.keys()){for(let l of s.get(i)){l.jewel&&l.jewel.remove();const s=this.matchChecker.generateUnmatchableShape(l.x,l.y),i=new t.default(l,s);i.generateRandomPromotion(this.level.specials,this.findJewelsPromoted()),i.move(e)}await this.game.delay(150)}this.animating=!1}async flipJewels(e,t){if(!e||!t)return;this.animating=!0,e.classList.add("flipping"),t.classList.add("flipping");const s=e.getBoundingClientRect(),i=t.getBoundingClientRect();e.x>t.x?(e.style.transform=`translate3d(${-s.width}px, 0, 0)`,t.style.transform=`translate3d(${i.width}px, 0, 0)`):e.x<t.x?(e.style.transform=`translate3d(${s.width}px, 0, 0)`,t.style.transform=`translate3d(${-i.width}px, 0, 0)`):e.y>t.y?(e.style.transform=`translate3d(0, ${-s.height}px, 0)`,t.style.transform=`translate3d(0, ${i.height}px, 0)`):(e.style.transform=`translate3d(0, ${s.height}px, 0)`,t.style.transform=`translate3d(0, ${-i.height}px, 0)`),await this.game.delay(150),e.classList.remove("flipping"),t.classList.remove("flipping");const l=this.findSlotByPosition(t.x,t.y),o=this.findSlotByPosition(e.x,e.y);l.jewel=e,o.jewel=t,this.explodeMatches(),this.unselectAll()}async explodeMatches(){const e=[];for(let s=this.level.size-1;s>-1;s--)for(let t=0;t<this.level.size;t++){const i=this.findJewelByPosition(t,s);i&&e.push(...this.matchChecker.findPossibleMatches(i))}if(0===e.length)return;this.animating=!0;const t=e.filter(e=>!e.futurePromotion);for(let s of t)s.slot.classList.add("exploding"),s.classList.add("exploding");await this.game.delay(250),t.forEach(e=>{e.setAttribute("hidden",""),e.classList.remove("exploding")}),await this.moveRows(),await this.fillEmptySlots(!1),await this.explodeMatches(),this.animating=!1}async moveRows(){const e=[];for(let t=this.level.size-1;t>-1;t--){let s=!1;const i=this.emptySlots.filter(e=>e.y===t);for(let t of i){const i=this.occupiedSlots.filter(t=>-1===e.indexOf(t)).filter(e=>e.x===t.x&&e.y<t.y).sort((e,t)=>t.y-e.y).shift();if(e.push(i),!i||!i.jewel)continue;s=!0,t.classList.remove("exploding"),i.jewel.futureSlot=t,i.jewel.classList.add("moving");const l=i.getBoundingClientRect().height*(t.y-i.y);i.jewel.style.transform=`translate3d(0, ${l}px, 0)`}if(s){await this.game.delay(150);const e=this.jewels.filter(e=>e.classList.contains("moving")).sort((e,t)=>t.y-e.y);for(let t of e){const e=t.slot,s=t.futureSlot,i=s.jewel;e.jewel=i,s.jewel=t,delete t.futureSlot}}}}}exports.default=r,customElements.define("game-board",r);
},{"./Slot":"o0GU","./Jewel":"DQ1O","./MatchChecker":"a9lQ","./MoveChecker":"1wX9"}],"QvaY":[function(require,module,exports) {
"use strict";var e,r=t(require("./Board"));function t(e){return e&&e.__esModule?e:{default:e}}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}new(e=class{constructor(){s(this,"levels",[{size:9,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},locks:[{x:2,y:2},{x:6,y:6}]}]),this.board=new r.default(this),document.querySelector("main").append(this.board),this.board.startLevel(this.levels[0])}delay(e=0,...r){return e?new Promise(t=>setTimeout(t,e,...r)):new Promise(e=>requestAnimationFrame(e))}});
},{"./Board":"Wb9I"}]},{},["QvaY"], null)</script></body></html>