<!DOCTYPE html><html lang="en"><head><title>Jewelsback</title><style>body,html{display:flex;justify-content:center;align-items:center;margin:0;padding:0;height:100vh;font:1.15em/1.3 sans-serif;background-image:linear-gradient(180deg,#1e528e 0,#728a7c 50%,#e9ce5d)}.transitions-off{transition:none!important}@keyframes slot-selected{0%{outline-color:rgba(51,102,153,.333);outline-offset:-5px}to{outline-color:rgba(51,102,153,.467);outline-offset:-7px}}@-webkit-keyframes slot-selected{0%{outline-color:rgba(51,102,153,.333);outline-offset:-5px}to{outline-color:rgba(51,102,153,.467);outline-offset:-7px}}@keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 hsla(0,0%,100%,.2)}15%,25%{box-shadow:inset 0 0 100px hsla(0,0%,100%,.2),0 0 50px hsla(0,0%,100%,.2)}}@-webkit-keyframes slot-exploding{0%,to{box-shadow:inset 0 0 0 hsla(0,0%,100%,.2),0 0 0 hsla(0,0%,100%,.2)}15%,25%{box-shadow:inset 0 0 100px hsla(0,0%,100%,.2),0 0 50px hsla(0,0%,100%,.2)}}@keyframes jewel-exploding{0%{opacity:1;transform:scale(1) translateY(0)}to{opacity:0;transform:scale(1.5) translateY(5%)}}@-webkit-keyframes jewel-exploding{0%{opacity:1;transform:scale(1) translateY(0)}to{opacity:0;transform:scale(1.5) translateY(5%)}}@keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.1)}}@-webkit-keyframes jewel-brightening{0%{filter:brightness(1)}to{filter:brightness(1.1)}}@keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.8);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}@-webkit-keyframes star-blinking{0%{transform:translateX(-50%);filter:brightness(1) drop-shadow(0 0 .5px rgba(255,255,255,.667))}to{transform:translateX(-50%) scale(.8);filter:brightness(1.075) drop-shadow(0 0 1px rgba(255,255,255,.667))}}game-board{display:grid;overflow:hidden;box-sizing:border-box;width:calc(100vmin - 30px);height:calc(100vmin - 30px);border:3px solid rgba(51,51,51,.6);border-radius:5px;cursor:pointer}game-board[grabbing]{cursor:grabbing!important}game-board[animating]{cursor:default!important}.prod game-board{transition:all .5s cubic-bezier(.645,.045,.355,1)}.dev game-board{transition:all .1s cubic-bezier(.645,.045,.355,1)}board-slot{position:relative;display:grid;padding:10px;box-sizing:border-box;outline:5px solid rgba(51,102,153,0);transition:all .5s ease}board-slot:empty{cursor:default}board-slot:nth-child(2n){background:rgba(17,17,17,.467)}board-slot:nth-child(odd){background:rgba(0,0,0,.467)}board-slot[locked]{border:3px solid rgba(51,51,51,.2);background:transparent;cursor:default}board-slot[selected]{outline-color:rgba(51,102,153,.6);outline-offset:-7px;background:rgba(17,51,102,.6);cursor:grabbing;animation:slot-selected .3s ease-in infinite alternate forwards}board-slot[selected] jewel-piece{z-index:2}board-slot.exploding{animation:slot-exploding .25s ease both}.dev board-slot[targetable]{background:rgba(204,136,0,.333)}jewel-piece{position:relative;z-index:1;box-sizing:border-box;transition:opacity .25s ease,filter .25s ease,transform .25s ease;display:flex}jewel-piece .border,jewel-piece .shape{flex:1;display:flex}jewel-piece .shape{margin:2px;display:flex}jewel-piece .shape:after{content:"";flex:1;margin:16%}jewel-piece.arriving,jewel-piece.moving{transition:opacity .15s ease-in,transform .15s ease-in}jewel-piece.exploding{animation:jewel-exploding .15s ease-out forwards}.dev jewel-piece[matchable]{filter:drop-shadow(1px 2px 5px #f00)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{border-radius:10%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .border{background:linear-gradient(130deg,#f88e86,#8d1108);margin:1px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape{background:radial-gradient(#f99890,#d4190c);background:conic-gradient(from 45deg,#f6695e,#f44336,#f2291a,#f65f54,#f44336,#f01d0d,#f65f54,#f44336,#f01d0d,#f5564a,#f44336,#f01d0d,#f6695e)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=square] .shape:after{background:linear-gradient(130deg,rgba(251,180,175,.4),rgba(248,142,134,.25))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond]{width:calc(100% + 4px);height:calc(100% + 4px);margin:-2px 0 0 -2px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .border{background:linear-gradient(130deg,#ffe69c,#b78a00)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape{background:radial-gradient(#fd7,#c49300);background:conic-gradient(from 30deg,#ffcd39,#ffc107,#ecb100,#ffca2c,#ffc107,#dfa700,#ffca2c,#ffc107,#dfa700,#ffc720,#ffc107,#dfa700,#ffcd39)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=diamond] .shape:after{background:linear-gradient(130deg,rgba(255,230,156,.5),rgba(255,218,106,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{border-radius:50%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .border{background:linear-gradient(130deg,#ffd5c8,#ad2a00);margin:1px}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape{background:radial-gradient(#ffa385,#d93400);background:conic-gradient(from 45deg,#ff794e,#ff5722,#ff4105,#ff7043,#ff5722,#f63b00,#ff7043,#ff5722,#f63b00,#ff6838,#ff5722,#f63b00,#ff794e)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=circle] .shape:after{background:linear-gradient(130deg,rgba(255,188,167,.5),rgba(255,154,122,.75))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{clip-path:polygon(50% 0,0 100%,100% 100%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .border{background:linear-gradient(130deg,#fcecff,#9f04b9)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape{background:radial-gradient(#ee96fd,#c705e7);background:conic-gradient(from 120deg,#e666fc,#e040fb,#db21fa,#e55dfc,#e040fb,#d812fa,#e55dfc,#e040fb,#d812fa,#e353fb,#e040fb,#d812fa,#e666fc)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=triangle] .shape:after{background:linear-gradient(130deg,rgba(243,179,253,.5),rgba(236,140,253,.9));margin:22% 16% 11%}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{clip-path:polygon(50% 0,100% 25%,100% 75%,50% 100%,0 75%,0 25%)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .border{background:linear-gradient(130deg,#f3f9ed,#547928)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape{background:radial-gradient(#bfde9b,#699832);background:conic-gradient(from 45deg,#a2cf6e,#8bc34a,#7eb63c,#9ccc65,#8bc34a,#77ac39,#9ccc65,#8bc34a,#77ac39,#97c95c,#8bc34a,#77ac39,#a2cf6e)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=hexagon] .shape:after{background:linear-gradient(130deg,rgba(209,231,183,.4),rgba(185,219,146,.55))}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape,jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{clip-path:polygon(30% 0,0 20%,0 55%,50% 100%,100% 55%,100% 20%,70% 0)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .border{background:linear-gradient(130deg,#d3eafd,#085b9d)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape{background:radial-gradient(#85c5f8,#0b72c4);background:conic-gradient(from 45deg,#4dabf5,#2196f3,#0d89ec,#42a6f5,#2196f3,#0c81df,#42a6f5,#2196f3,#0c81df,#37a1f4,#2196f3,#0c81df,#4dabf5)}jewel-piece:not([promoted=rainbow]):not([promoted=nebula])[type=heptagon] .shape:after{background:linear-gradient(130deg,rgba(166,213,250,.4),rgba(122,192,248,.55))}jewel-piece[promoted]{animation:jewel-brightening 1s ease .5s infinite alternate both}jewel-piece[promoted]:after,jewel-piece[promoted]:before{position:absolute;left:50%;z-index:2;width:175%;height:175%;background-position:50%;background-size:100% 100%;content:"";transform:translateX(-50%);pointer-events:none}jewel-piece[promoted]:before{z-index:-1}jewel-piece[promoted=smoke]:after,jewel-piece[promoted=smoke]:before{background-image:url(smoke.eccdc0d4.webp)}jewel-piece[promoted=smoke]:before{width:180%;height:180%;top:-35%;filter:brightness(1.3) contrast(1.5)}jewel-piece[promoted=smoke]:after{width:125%;height:125%;top:-12%;filter:brightness(5) contrast(1.2) opacity(.5)}jewel-piece[promoted=fire]:before{background-image:url(smoke.eccdc0d4.webp);width:160%;height:160%;top:-25%;filter:brightness(1.2) contrast(1.5) opacity(.5)}jewel-piece[promoted=fire]:after{width:215%;bottom:9px;left:52%;filter:saturate(2) brightness(1.2) contrast(1.25) opacity(1);background-image:url(fire.787f7985.webp)}jewel-piece[promoted=star]:before{background-image:url(smoke.eccdc0d4.webp);width:160%;height:160%;top:-25%;filter:brightness(1.5) contrast(1.5) opacity(.5)}jewel-piece[promoted=star]:after{animation:star-blinking .85s ease .5s infinite alternate both;width:120%;height:120%;top:-10%;clip-path:polygon(50% 0,61% 35%,100% 50%,61% 61%,50% 100%,39% 61%,0 50%,39% 35%);background-image:radial-gradient(circle,hsla(0,0%,100%,.733),hsla(0,0%,100%,.133));mix-blend-mode:lighten}jewel-piece[promoted=rainbow] .border,jewel-piece[promoted=rainbow] .shape,jewel-piece[promoted=rainbow] .shape:after{border-radius:10%;clip-path:none}jewel-piece[promoted=rainbow] .border{background:linear-gradient(130deg,#efeeea,#7c735e);margin:1px}jewel-piece[promoted=rainbow] .shape{background:linear-gradient(90deg,#f44336,#ff5722,#ffc107,#8bc34a,#2196f3,#e040fb,#f44336)}jewel-piece[promoted=rainbow] .shape:after{background:linear-gradient(130deg,rgba(223,220,213,.3),rgba(223,220,213,.5));z-index:1}jewel-piece[promoted=nebula]{margin:-3px}jewel-piece[promoted=nebula] .border,jewel-piece[promoted=nebula] .shape{border-radius:50%;clip-path:none}jewel-piece[promoted=nebula] .border{background:linear-gradient(130deg,#b8c7ce,#4c636e);margin:1px}jewel-piece[promoted=nebula] .shape{background:linear-gradient(130deg,#455a64,#34444b)}jewel-piece[promoted=nebula] .shape:after{display:none}jewel-piece[promoted=nebula]:after,jewel-piece[promoted=nebula]:before{background-image:url(smoke.eccdc0d4.webp)}jewel-piece[promoted=nebula]:before{width:160%;height:160%;top:-25%;filter:brightness(1.2) contrast(1.5) opacity(.5)}jewel-piece[promoted=nebula]:after{top:-39%;filter:brightness(0) contrast(2)}</style></head><body><main></main><script>parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"o0GU":[function(require,module,exports) {
"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,s){super(),t(this,"lastClick",null),this.x=e,this.y=s,this.addEventListener("mousedown",this.mousedown),this.addEventListener("mouseup",this.mouseup),this.addEventListener("dragstart",t=>t.preventDefault())}get locked(){return""===this.getAttribute("locked")}set locked(t){t?this.setAttribute("locked",""):this.removeAttribute("locked")}get selected(){return""===this.getAttribute("selected")}set selected(t){t?this.setAttribute("selected",""):this.removeAttribute("selected"),this.jewel&&!t&&(this.jewel.matchable=!1)}get targetable(){return""===this.getAttribute("targetable")}set targetable(t){t?this.setAttribute("targetable",""):this.removeAttribute("targetable")}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get game(){return this.board.game}get board(){return this.parentElement}get jewel(){return this.firstElementChild}set jewel(t){this.game.enableTransitions(t,!1),t.x=this.x,t.y=this.y,this.game.setStyles(t,{transform:null}),this.appendChild(t),this.game.enableTransitions(t)}mousedown(){if(!this.board.animating)return this.locked?this.board.unselectAll():void(null===this.board.findJewelSelected()&&(this.board.unselectAll(),this.board.updateTargetables(this),this.board.grabbing=!0,this.selected=!0,this.lastClick=Date.now()))}mouseup(){if(!this.board.animating){if(this.board.grabbing=!1,this.locked)return this.board.unselectAll();if(this.targetable){const t=this.board.findJewelSelected();return this.board.flipJewels(this.jewel,t)}(!this.lastClick||Date.now()-this.lastClick>250)&&this.board.unselectAll()}}}exports.default=e,customElements.define("board-slot",e);
},{}],"DQ1O":[function(require,module,exports) {
"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(t,e,s){super(),this.type=s,this.checked=!1,this.x=t,this.y=e,this.className="arriving transitions-off";const r=document.createElement("div");r.className="border",this.append(r);const i=document.createElement("div");i.className="shape",r.append(i)}connectedCallback(){if(this.classList.contains("arriving")){const t=-this.offsetHeight-this.board.offsetTop-this.slot.offsetTop;this.game.setStyles(this,{opacity:.5,transform:`translateY(${t}px)`})}}get type(){return this.getAttribute("type")}set type(t){this.setAttribute("type",t)}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get matchable(){return""===this.getAttribute("matchable")}set matchable(t){t?this.setAttribute("matchable",""):this.removeAttribute("matchable")}get promoted(){return this.getAttribute("promoted")}set promoted(t){t?this.setAttribute("promoted",t):this.removeAttribute("promoted")}get game(){return this.board.game}get board(){return this.slot.parentElement}get slot(){return this.parentElement}get above(){return this.parentElement}get canBePromoted(){return this.matchable&&!this.promoted}generateRandomPromotion(t){const e=t.length+this.board.level.size*(this.board.level.size/2),s=Math.floor(Math.random()*e);return s<t.length?t[s]:null}async arrive(){const t=`${((this.y+1)/(2*this.board.level.size)).toFixed(2)}s`;await this.game.setStylesWithTransition(this,{opacity:null,transform:null,transitionDuration:t}),await this.game.setStyles(this,{transitionDuration:null}),this.classList.remove("arriving")}}exports.default=e,t(e,"types",{square:"square",heptagon:"heptagon",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",circle:"circle"}),t(e,"specials",{smoke:"smoke",fire:"fire",star:"star",rainbow:"rainbow",nebula:"nebula"}),customElements.define("jewel-piece",e);
},{}],"a9lQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("./Jewel"));function e(i){return i&&i.__esModule?i:{default:i}}class t{constructor(i){this.board=i}generateUnmatchableShape(e,t,o){const s=Object.keys(i.default.types).filter(i=>i!==o),n=s[Math.random()*s.length<<0],h=this.board.findJewelByPosition(e-1,t),d=this.board.findJewelByPosition(e,t+1),a=this.board.findJewelByPosition(e-1,t+1);if(h&&d&&a&&d.type===n&&h.type===n&&a.type===n)return this.generateUnmatchableShape(e,t,n);const r=this.board.findJewelByPosition(e-2,t);if(h&&r&&h.type===n&&r.type===n)return this.generateUnmatchableShape(e,t,n);const l=this.board.findJewelByPosition(e,t+2);return d&&l&&d.type===n&&l.type===n?this.generateUnmatchableShape(e,t,n):n}checkMatchables(i,...e){for(let t of e)if(!t||i.type!==t.type)return[];return[i,...e]}findPossibleMatches(i){if(!i)return[];const e=[];if(e.push(...this.findMatchesForNebula(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForRainbow(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForStar(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForFire(i,i.canBePromoted)),e.length>0)return e;e.push(...this.findMatchesForSmoke(i,i.canBePromoted)),e.push(...this.findMatchesOfThree(i));for(let t of e)t.checked=!0;return e}findMatchesForNebula(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-3,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+3,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-3),this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2),this.board.findJewelByPosition(o,s+3))),this.promote(t,n,e,i.default.specials.nebula)}findMatchesForRainbow(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),this.promote(t,n,e,i.default.specials.rainbow)}findMatchesForStar(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1))),this.promote(t,n,e,i.default.specials.star)}findMatchesForFire(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),this.promote(t,n,e,i.default.specials.fire)}findMatchesForSmoke(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o,s-1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1))),this.promote(t,n,e,i.default.specials.smoke)}findMatchesOfThree(i){const{x:e,y:t}=i;let o=[];return o.push(...this.checkMatchables(i,this.board.findJewelByPosition(e-1,t),this.board.findJewelByPosition(e+1,t))),o.push(...this.checkMatchables(i,this.board.findJewelByPosition(e,t-1),this.board.findJewelByPosition(e,t+1))),o.filter(i=>null!==i)}promote(i,e,t,o){return e=e.filter(i=>null!==i),i&&e.length>0&&(t.promoted=o),e}}exports.default=t;
},{"./Jewel":"DQ1O"}],"1wX9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class i{constructor(i){this.board=i}findPossibleMoves(i){return i?[...this.findDirectMoves(i),...this.findIndirectMoves(i)]:[]}findDirectMoves(i){return i?[...this.findPossibleMovesTop(i),...this.findPossibleMovesRight(i),...this.findPossibleMovesBottom(i),...this.findPossibleMovesLeft(i)]:[]}findIndirectMoves(i){if(!i)return[];const e=[],{x:t,y:o}=i,s=this.board.findJewelByPosition(t,o-1),h=this.board.findJewelByPosition(t+1,o),n=this.board.findJewelByPosition(t,o+1),d=this.board.findJewelByPosition(t-1,o);return s&&e.push(...this.findPossibleMovesBottom(s,!0)),h&&e.push(...this.findPossibleMovesLeft(h,!0)),n&&e.push(...this.findPossibleMovesTop(n,!0)),d&&e.push(...this.findPossibleMovesRight(d,!0)),e}checkMatchable(i,e,t,...o){if(i.type===e.type)return null;for(let s of o)if(!s||i.type!==s.type)return null;return t?i:e}findPossibleMovesTop(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o,s-1);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o+1,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-3))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s-2),this.board.findJewelByPosition(o,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s-2),this.board.findJewelByPosition(o,s-2))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesRight(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o+1,s);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+3,s))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+1,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+2,s+1))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesBottom(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o,s+1);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+2,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-2,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o+1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o,s+2),this.board.findJewelByPosition(o,s+3))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-1,s+2),this.board.findJewelByPosition(o,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+1,s+2),this.board.findJewelByPosition(o,s+2))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesLeft(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o-1,s);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-3,s))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-1,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-2,s+1))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}}exports.default=i;
},{}],"Wb9I":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=l(require("./Slot")),e=l(require("./Jewel")),s=l(require("./MatchChecker")),i=l(require("./MoveChecker"));function l(t){return t&&t.__esModule?t:{default:t}}function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a extends HTMLElement{constructor(t){super(),o(this,"slots",[]),o(this,"level",null),this.game=t,this.matchChecker=new s.default(this),this.moveChecker=new i.default(this),document.addEventListener("click",t=>{const e=[document.documentElement,document.body];t.target&&!e.includes(t.target)||(t.stopPropagation(),this.unselectAll())})}get grabbing(){return""===this.getAttribute("grabbing")}set grabbing(t){t?this.setAttribute("grabbing",""):this.removeAttribute("grabbing")}get animating(){return""===this.getAttribute("animating")}set animating(t){t?this.setAttribute("animating",""):this.removeAttribute("animating")}get jewels(){return this.occupiedSlots.map(t=>t.firstChild)}get unlockedSlots(){return this.slots.filter(t=>!t.locked)}get occupiedSlots(){return this.unlockedSlots.filter(t=>t.jewel)}get emptySlots(){return this.unlockedSlots.filter(t=>!t.jewel||t.jewel.classList.contains("moving"))}get emptySlotsGroupedByRow(){const t=this.emptySlots.sort((t,e)=>e.y-t.y||t.x-e.x),e=new Map;return t.forEach(t=>{const s=e.get(t.y);s?s.push(t):e.set(t.y,[t])}),e}async startLevel(e){this.slots=[],this.level=e,this.animating=!0,this.game.setStyles(this,{opacity:0,transform:"scale(.75)",gridTemplateColumns:`repeat(${e.size}, 1fr)`,gridTemplateRows:`repeat(${e.size}, 1fr)`});for(let s=0;s<e.size;s++)for(let i=0;i<e.size;i++){const l=new t.default(i,s);l.locked=e.locks.some(t=>t.x===i&&t.y===s),this.append(l),this.slots.push(l)}await this.game.setStylesWithTransition(this,{opacity:1,transform:"scale(1)"}),await this.fillEmptySlots(),this.animating=!1}async fillEmptySlots(){const t=this.emptySlotsGroupedByRow,s=this.level.specials;for(let i of t.keys()){for(let l of t.get(i)){const t=this.matchChecker.generateUnmatchableShape(l.x,l.y),i=new e.default(l.x,l.y,t);if(l.append(i),s){const t=[];s.smoke>this.findJewelsBySpecial("smoke").length&&t.push("smoke"),s.fire>this.findJewelsBySpecial("fire").length&&t.push("fire"),s.star>this.findJewelsBySpecial("star").length&&t.push("star"),s.rainbow>this.findJewelsBySpecial("rainbow").length&&t.push("rainbow"),s.nebula>this.findJewelsBySpecial("nebula").length&&t.push("nebula"),i.promoted=i.generateRandomPromotion(t)}l.jewel.arrive()}await this.game.delay("prod"===this.game.ENV?150:1)}}findSlotByPosition(t,e){return this.querySelector(`board-slot[x="${t}"][y="${e}"]`)}findUnlockedSlotBelow(t){return this.unlockedSlots.filter(e=>e.x===t.x&&e.y>t.y).sort((t,e)=>t.y-e.y).shift()}findJewelByPosition(t,e){return this.querySelector(`jewel-piece[x="${t}"][y="${e}"]`)}findJewelSelected(){return this.querySelector("board-slot[selected] > jewel-piece")}findJewelsBySpecial(t){return this.querySelectorAll(`jewel-piece[promoted="${t}"]`)}unselectAll(){for(let t of this.unlockedSlots)t.targetable=!1,t.selected=!1}updateTargetables(t){const e=this.moveChecker.findPossibleMoves(t.jewel);for(let s of e)s.slot.targetable=!0}async flipJewels(t,e){if(!t||!e)return;this.animating=!0,t.x>e.x?(this.game.setStylesWithTransition(t,{transform:`translateX(${-t.slot.offsetWidth}px)`}),await this.game.setStylesWithTransition(e,{transform:`translateX(${e.slot.offsetWidth}px)`})):t.x<e.x?(this.game.setStylesWithTransition(t,{transform:`translateX(${t.slot.offsetWidth}px)`}),await this.game.setStylesWithTransition(e,{transform:`translateX(${-e.slot.offsetWidth}px)`})):t.y>e.y?(this.game.setStylesWithTransition(t,{transform:`translateY(${-t.slot.offsetHeight}px)`}),await this.game.setStylesWithTransition(e,{transform:`translateY(${e.slot.offsetHeight}px)`})):(this.game.setStylesWithTransition(t,{transform:`translateY(${t.slot.offsetHeight}px)`}),await this.game.setStylesWithTransition(e,{transform:`translateY(${-e.slot.offsetHeight}px)`}));const s=this.findSlotByPosition(e.x,e.y),i=this.findSlotByPosition(t.x,t.y);s.jewel=t,i.jewel=e,this.explodeMatches(),this.unselectAll()}async explodeMatches(){const t=[];for(let s=this.level.size-1;s>-1;s--)for(let e=0;e<this.level.size;e++){const i=this.findJewelByPosition(e,s);i&&t.push(...this.matchChecker.findPossibleMatches(i))}if(0===t.length)return;this.animating=!0;const e=t.filter(t=>!t.promoted);for(let s of e)s.slot.classList.add("exploding"),s.classList.add("exploding");await this.game.delay(100),e.forEach(t=>t.remove()),await this.moveRows(),await this.fillEmptySlots(),await this.explodeMatches(),this.animating=!1}async moveRows(){const t=[];for(let s=this.level.size-1;s>-1;s--){const e=this.emptySlots.filter(t=>t.y===s);for(let s of e){const e=this.occupiedSlots.filter(e=>-1===t.indexOf(e)).filter(t=>t.x===s.x&&t.y<s.y).sort((t,e)=>e.y-t.y).shift();if(t.push(e),!e||!e.jewel)continue;s.classList.remove("exploding"),e.jewel.classList.add("moving"),e.jewel.future=s;const i=s.y-e.y;this.game.setStylesWithTransition(e.jewel,{transform:`translateY(${e.offsetHeight*i}px)`})}await this.game.delay(125)}const e=this.jewels.filter(t=>t.classList.contains("moving")).sort((t,e)=>e.y-t.y);for(let s of e){const t=s.future;s.classList.remove("moving"),this.game.setStyles(s,{transform:null}),t.append(s),s.x=t.x,s.y=t.y,delete s.future}}}exports.default=a,customElements.define("game-board",a);
},{"./Slot":"o0GU","./Jewel":"DQ1O","./MatchChecker":"a9lQ","./MoveChecker":"1wX9"}],"QvaY":[function(require,module,exports) {
"use strict";var e,t=s(require("./Board"));function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}new(e=class{constructor(){n(this,"ENV","prod"),n(this,"levels",[{size:9,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},locks:[{x:2,y:2},{x:6,y:6}]}]),document&&document.documentElement.classList.add(this.ENV),this.board=new t.default(this),document.querySelector("main").append(this.board),this.board.startLevel(this.levels[0])}delay(e=0,...t){return e?new Promise(s=>setTimeout(s,e,...t)):new Promise(e=>requestAnimationFrame(e))}setStylesWithTransition(e,t){return this.setStyles(e,t,!0)}setStyles(e,t,s=!1){return s?this.enableTransitions(e,!0):this.enableTransitions(e,!1),Object.keys(t).forEach(s=>e.style[s]=t[s]),e.offsetHeight,s?new Promise(t=>{const s=()=>{e.removeEventListener("transitionend",s),t()};e.addEventListener("transitionend",s)}):this.delay()}enableTransitions(e,t=!0){t?e.classList.remove("transitions-off"):e.classList.add("transitions-off")}});
},{"./Board":"Wb9I"}]},{},["QvaY"], null)</script></body></html>