parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"+sFh":[function(require,module,exports) {
"use strict";function t(){const t=1e4;let e,i,n,o,r,d;function s(){const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width",window.innerWidth),s.setAttribute("height",window.innerHeight),document.querySelector("#background").appendChild(s);const c=(window.innerWidth+window.innerHeight)/20;i=Math.ceil(window.innerWidth/c)+1,n=Math.ceil(window.innerHeight/c)+1,o=Math.ceil(window.innerWidth/(i-1)),r=Math.ceil(window.innerHeight/(n-1)),d=[];for(let t=0;t<n;t++)for(let e=0;e<i;e++)d.push({x:o*e,y:r*t,originX:o*e,originY:r*t});u();for(let e=0;e<d.length;e++)if(d[e].originX!==o*(i-1)&&d[e].originY!==r*(n-1)){const n=d[e].x,o=d[e].y,r=d[e+1].x,u=d[e+1].y,c=d[e+i].x,l=d[e+i].y,p=d[e+i+1].x,a=d[e+i+1].y,g=Math.floor(2*Math.random());for(let d=0;d<2;d++){const h=document.createElementNS(s.namespaceURI,"polygon");0===g?0===d?(h.point1=e,h.point2=e+i,h.point3=e+i+1,h.setAttribute("points",`${n},${o} ${c},${l} ${p},${a}`)):1===d&&(h.point1=e,h.point2=e+1,h.point3=e+i+1,h.setAttribute("points",`${n},${o} ${r},${u} ${p},${a}`)):1===g&&(0===d?(h.point1=e,h.point2=e+i,h.point3=e+1,h.setAttribute("points",`${n},${o} ${c},${l} ${r},${u}`)):1===d&&(h.point1=e+i,h.point2=e+1,h.point3=e+i+1,h.setAttribute("points",`${c},${l} ${r},${u} ${p},${a}`))),h.setAttribute("fill",`rgba(0,0,0,${Math.random()/3})`);const $=document.createElementNS("http://www.w3.org/2000/svg","animate");$.setAttribute("fill","freeze"),$.setAttribute("attributeName","points"),$.setAttribute("dur",`${t}ms`),$.setAttribute("calcMode","linear"),h.appendChild($),s.appendChild(h)}}!function i(){u();for(let t=0;t<document.querySelector("#background svg").childNodes.length;t++){const e=document.querySelector("#background svg").childNodes[t],i=e.childNodes[0];i.getAttribute("to")&&i.setAttribute("from",i.getAttribute("to")),i.setAttribute("to",`${d[e.point1].x},${d[e.point1].y} ${d[e.point2].x},${d[e.point2].y} ${d[e.point3].x},${d[e.point3].y}`),i.beginElement()}e=setTimeout(()=>{i()},t)}()}function u(){for(let t=0;t<d.length;t++)0!==d[t].originX&&d[t].originX!==o*(i-1)&&(d[t].x=d[t].originX+Math.random()*o-o/2),0!==d[t].originY&&d[t].originY!==r*(n-1)&&(d[t].y=d[t].originY+Math.random()*r-r/2)}window.onload=s,window.onresize=function(){document.querySelector("#background svg").remove(),clearTimeout(e),s()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"o0GU":[function(require,module,exports) {
"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,s){super(),t(this,"lastClick",null),this.x=e,this.y=s,this.addEventListener("mousedown",this.mousedown),this.addEventListener("mouseup",this.mouseup),this.addEventListener("dragstart",t=>t.preventDefault())}connectedCallback(){0===this.y&&this.classList.add("first-row"),this.y===this.board.level.size-1&&this.classList.add("last-row"),0===this.x&&this.classList.add("first-column"),this.x===this.board.level.size-1&&this.classList.add("last-column")}get locked(){return""===this.getAttribute("locked")}set locked(t){t?this.setAttribute("locked",""):this.removeAttribute("locked")}get selected(){return""===this.getAttribute("selected")}set selected(t){t?this.setAttribute("selected",""):this.removeAttribute("selected"),this.jewel&&!t&&(this.jewel.matchable=!1)}get targetable(){return""===this.getAttribute("targetable")}set targetable(t){t?this.setAttribute("targetable",""):this.removeAttribute("targetable")}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get game(){return this.board.game}get board(){return this.parentElement}get jewel(){return this.firstElementChild}set jewel(t){t.x=this.x,t.y=this.y,t.classList.remove("moving"),t.style.transform=null,this.append(t)}mousedown(){if(!this.board.animating)return this.locked?this.board.unselectAll():void(null===this.board.findJewelSelected()&&(this.board.unselectAll(),this.board.updateTargetables(this),this.board.grabbing=!0,this.selected=!0,this.lastClick=Date.now()))}mouseup(){if(!this.board.animating){if(this.board.grabbing=!1,this.locked)return this.board.unselectAll();if(this.targetable){const t=this.board.findJewelSelected();return this.board.flipJewels(this.jewel,t)}(!this.lastClick||Date.now()-this.lastClick>250)&&this.board.unselectAll()}}}exports.default=e,customElements.define("board-slot",e);
},{}],"DQ1O":[function(require,module,exports) {
"use strict";function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e extends HTMLElement{constructor(e,r){super(),t(this,"futureSlot",null),t(this,"futurePromotion",!1),this.type=r,this.checked=!1,this.x=e.x,this.y=e.y,this.setAttribute("hidden","");const s=document.createElement("div"),i=document.createElement("div");s.className="border",this.append(s),i.className="shape",s.append(i),e.append(this)}get type(){return this.getAttribute("type")}set type(t){this.setAttribute("type",t)}get x(){return+this.getAttribute("x")}set x(t){this.setAttribute("x",t)}get y(){return+this.getAttribute("y")}set y(t){this.setAttribute("y",t)}get matchable(){return""===this.getAttribute("matchable")}set matchable(t){t?this.setAttribute("matchable",""):this.removeAttribute("matchable")}get promoted(){return this.getAttribute("promoted")}set promoted(t){t?this.setAttribute("promoted",t):this.removeAttribute("promoted")}get game(){return this.board.game}get board(){return this.slot.parentElement}get slot(){return this.parentElement}get above(){return this.parentElement}get canBePromoted(){return this.matchable&&!this.promoted}generateRandomPromotion(t,e){if(t){const r=[];if(t.smoke>e.filter(t=>"smoke"===t.promoted).length&&r.push("smoke"),t.fire>e.filter(t=>"fire"===t.promoted).length&&r.push("fire"),t.star>e.filter(t=>"star"===t.promoted).length&&r.push("star"),t.rainbow>e.filter(t=>"rainbow"===t.promoted).length&&r.push("rainbow"),t.nebula>e.filter(t=>"nebula"===t.promoted).length&&r.push("nebula"),r.length>0){const e=Object.values(t).reduce((t,e)=>t+e)+this.board.level.size*(this.board.level.size/2),s=Math.floor(Math.random()*e);s<r.length&&(this.promoted=Object.values(r)[s])}}}async move(t=!0){if(this.removeAttribute("hidden"),t)this.classList.add("arriving"),await this.game.delay(150),this.classList.remove("arriving");else{const t=this.slot.getBoundingClientRect().height*(this.y+1);this.style.transform=`translate3d(0, ${-t}px, 0)`,await this.game.delay(),this.classList.add("falling"),this.style.transform=null,await this.game.delay(150),this.classList.remove("falling")}}}exports.default=e,t(e,"types",{square:"square",heptagon:"heptagon",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",circle:"circle"}),t(e,"specials",{smoke:"smoke",fire:"fire",star:"star",rainbow:"rainbow",nebula:"nebula"}),customElements.define("jewel-piece",e);
},{}],"a9lQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("./Jewel"));function e(i){return i&&i.__esModule?i:{default:i}}class t{constructor(i){this.board=i}generateUnmatchableShape(e,t,o){const s=Object.keys(i.default.types).filter(i=>i!==o),n=s[Math.random()*s.length<<0],h=this.board.findJewelByPosition(e-1,t),d=this.board.findJewelByPosition(e,t+1),a=this.board.findJewelByPosition(e-1,t+1);if(h&&d&&a&&d.type===n&&h.type===n&&a.type===n)return this.generateUnmatchableShape(e,t,n);const r=this.board.findJewelByPosition(e-2,t);if(h&&r&&h.type===n&&r.type===n)return this.generateUnmatchableShape(e,t,n);const l=this.board.findJewelByPosition(e,t+2);return d&&l&&d.type===n&&l.type===n?this.generateUnmatchableShape(e,t,n):n}checkMatchables(i,...e){for(let t of e)if(!t||i.type!==t.type)return[];return[i,...e]}findPossibleMatches(i){if(!i)return[];const e=[];if(e.push(...this.findMatchesForNebula(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForRainbow(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForStar(i,i.canBePromoted)),e.length>0)return e;if(e.push(...this.findMatchesForFire(i,i.canBePromoted)),e.length>0)return e;e.push(...this.findMatchesForSmoke(i,i.canBePromoted)),e.push(...this.findMatchesOfThree(i));for(let t of e)t.checked=!0;return e}findMatchesForNebula(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-3,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+3,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-3),this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2),this.board.findJewelByPosition(o,s+3))),this.promote(t,n,e,i.default.specials.nebula)}findMatchesForRainbow(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),this.promote(t,n,e,i.default.specials.rainbow)}findMatchesForStar(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s-2))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1))),this.promote(t,n,e,i.default.specials.star)}findMatchesForFire(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+2,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o+1,s))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o,s-1),this.board.findJewelByPosition(o,s+1),this.board.findJewelByPosition(o,s+2))),this.promote(t,n,e,i.default.specials.fire)}findMatchesForSmoke(e,t){const{x:o,y:s}=e;let n=[];return n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o,s+1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s),this.board.findJewelByPosition(o,s-1))),n.push(...this.checkMatchables(e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s),this.board.findJewelByPosition(o,s-1))),this.promote(t,n,e,i.default.specials.smoke)}findMatchesOfThree(i){const{x:e,y:t}=i;let o=[];return o.push(...this.checkMatchables(i,this.board.findJewelByPosition(e-1,t),this.board.findJewelByPosition(e+1,t))),o.push(...this.checkMatchables(i,this.board.findJewelByPosition(e,t-1),this.board.findJewelByPosition(e,t+1))),o.filter(i=>null!==i)}promote(i,e,t,o){return e=e.filter(i=>null!==i),i&&e.length>0&&(t.futurePromotion=!0,t.promoted=o),e}}exports.default=t;
},{"./Jewel":"DQ1O"}],"1wX9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var i=e(require("./Jewel"));function e(i){return i&&i.__esModule?i:{default:i}}class t{constructor(i){this.board=i}findPossibleMoves(i){return i?[...this.findDirectMoves(i),...this.findIndirectMoves(i)]:[]}findDirectMoves(i){return i?[...this.findPossibleMovesTop(i),...this.findPossibleMovesRight(i),...this.findPossibleMovesBottom(i),...this.findPossibleMovesLeft(i)]:[]}findIndirectMoves(i){if(!i)return[];const e=[],{x:t,y:o}=i,s=this.board.findJewelByPosition(t,o-1),h=this.board.findJewelByPosition(t+1,o),n=this.board.findJewelByPosition(t,o+1),d=this.board.findJewelByPosition(t-1,o);return s&&e.push(...this.findPossibleMovesBottom(s,!0)),h&&e.push(...this.findPossibleMovesLeft(h,!0)),n&&e.push(...this.findPossibleMovesTop(n,!0)),d&&e.push(...this.findPossibleMovesRight(d,!0)),e}checkMatchable(e,t,o,...s){if(e.type===t.type)return null;for(let h of s)if(!h||e.type!==h.type&&e.promoted!==i.default.specials.nebula&&e.promoted!==i.default.specials.rainbow)return null;return o?e:t}findPossibleMovesTop(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o,s-1);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o+1,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o,s-2),this.board.findJewelByPosition(o,s-3))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s-2),this.board.findJewelByPosition(o,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s-2),this.board.findJewelByPosition(o,s-2))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesRight(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o+1,s);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+3,s))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+1,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s-1),this.board.findJewelByPosition(o+2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+2,s),this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+2,s+1))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesBottom(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o,s+1);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+2,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-2,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o+1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o,s+2),this.board.findJewelByPosition(o,s+3))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-1,s+2),this.board.findJewelByPosition(o,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o+1,s+1),this.board.findJewelByPosition(o+1,s+2),this.board.findJewelByPosition(o,s+2))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}findPossibleMovesLeft(i,e=!1){let t=[];const{x:o,y:s}=i,h=this.board.findJewelByPosition(o-1,s);return!h||h.locked?[]:(t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-3,s))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-1,s+2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s-2))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-1,s+1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s-1),this.board.findJewelByPosition(o-2,s-1))),t.push(this.checkMatchable(i,h,e,this.board.findJewelByPosition(o-2,s),this.board.findJewelByPosition(o-1,s+1),this.board.findJewelByPosition(o-2,s+1))),(t=t.filter(i=>null!==i)).length>0&&(i.matchable=!0),t)}}exports.default=t;
},{"./Jewel":"DQ1O"}],"Wb9I":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("./Slot")),t=l(require("./Jewel")),s=l(require("./MatchChecker")),i=l(require("./MoveChecker"));function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r extends HTMLElement{constructor(e){super(),o(this,"slots",[]),o(this,"level",null),o(this,"height",null),o(this,"scoreMultiplier",0),this.game=e,this.matchChecker=new s.default(this),this.moveChecker=new i.default(this),document.addEventListener("click",e=>{const t=[document.documentElement,document.body];e.target&&!t.includes(e.target)||(e.stopPropagation(),this.unselectAll())})}connectedCallback(){this.height=this.offsetHeight}get grabbing(){return""===this.getAttribute("grabbing")}set grabbing(e){e?this.setAttribute("grabbing",""):this.removeAttribute("grabbing")}get animating(){return""===this.getAttribute("animating")}set animating(e){e?this.setAttribute("animating",""):this.removeAttribute("animating")}get jewels(){return this.occupiedSlots.map(e=>e.firstChild)}get unlockedSlots(){return this.slots.filter(e=>!e.locked)}get occupiedSlots(){return this.unlockedSlots.filter(e=>e.jewel&&!e.jewel.hasAttribute("hidden"))}get emptySlots(){return this.unlockedSlots.filter(e=>!e.jewel||e.jewel.hasAttribute("hidden")||e.jewel.classList.contains("moving"))}get emptySlotsGroupedByRow(){const e=this.emptySlots.sort((e,t)=>t.y-e.y||e.x-t.x),t=new Map;return e.forEach(e=>{const s=t.get(e.y);s?s.push(e):t.set(e.y,[e])}),t}findSlotByPosition(e,t){return this.querySelector(`board-slot[x="${e}"][y="${t}"]`)}findUnlockedSlotBelow(e){return this.unlockedSlots.filter(t=>t.x===e.x&&t.y>e.y).sort((e,t)=>e.y-t.y).shift()}findJewelByPosition(e,t){return this.querySelector(`jewel-piece[x="${e}"][y="${t}"]`)}findJewelSelected(){return this.querySelector("board-slot[selected] > jewel-piece")}findJewelsByType(e){return this.querySelectorAll(`jewel-piece[type="${e}"]`)}findJewelsBySpecial(e){return this.querySelectorAll(`jewel-piece[promoted="${e}"]`)}findJewelsPromoted(){return Array.from(this.querySelectorAll("jewel-piece[promoted]"))}unselectAll(){for(let e of this.unlockedSlots)e.targetable=!1,e.selected=!1}updateTargetables(e){const t=this.moveChecker.findPossibleMoves(e.jewel);for(let s of t)s.slot.targetable=!0}async startLevel(t){this.slots=[],this.level=t,this.style.gridTemplateColumns=this.style.gridTemplateRows=`repeat(${t.size}, 1fr)`;for(let s=0;s<t.size;s++)for(let i=0;i<t.size;i++){const l=new e.default(i,s);l.locked=t.locks.some(e=>e.x===i&&e.y===s),this.append(l),this.slots.push(l)}await this.game.delay(250),await this.fillEmptySlots()}async fillEmptySlots(e=!0){this.animating=!0;const s=this.emptySlotsGroupedByRow;for(let i of s.keys()){for(let l of s.get(i)){l.jewel&&l.jewel.remove();const s=this.matchChecker.generateUnmatchableShape(l.x,l.y),i=new t.default(l,s);i.generateRandomPromotion(this.level.specials,this.findJewelsPromoted()),i.move(e)}await this.game.delay(e?200:100)}this.animating=!1}async flipJewels(e,s){if(!e||!s)return;this.animating=!0,this.scoreMultiplier=0,e.classList.add("flipping"),s.classList.add("flipping");const i=e.getBoundingClientRect(),l=s.getBoundingClientRect();e.x>s.x?(e.style.transform=`translate3d(${-i.width}px, 0, 0)`,s.style.transform=`translate3d(${l.width}px, 0, 0)`):e.x<s.x?(e.style.transform=`translate3d(${i.width}px, 0, 0)`,s.style.transform=`translate3d(${-l.width}px, 0, 0)`):e.y>s.y?(e.style.transform=`translate3d(0, ${-i.height}px, 0)`,s.style.transform=`translate3d(0, ${l.height}px, 0)`):(e.style.transform=`translate3d(0, ${i.height}px, 0)`,s.style.transform=`translate3d(0, ${-l.height}px, 0)`),await this.game.delay(150),e.classList.remove("flipping"),s.classList.remove("flipping");const o=this.findSlotByPosition(s.x,s.y),r=this.findSlotByPosition(e.x,e.y);o.jewel=e,r.jewel=s,e.promoted===t.default.specials.nebula?this.explodeNebula(e,s):s.promoted===t.default.specials.nebula?this.explodeNebula(s,e):e.promoted===t.default.specials.rainbow?this.explodeRainbow(e,s):s.promoted===t.default.specials.rainbow?this.explodeRainbow(s,e):this.explodeMatches(),this.unselectAll()}async explodeNebula(e,s){const i=[],l=[e];l.push(...this.findJewelsByType(s.type)),l.forEach(e=>{e.promoted&&!e.futurePromotion?l.push(e):i.push(e)}),i.length>0&&(this.scoreMultiplier++,i.forEach(e=>{this.game.score+=this.scoreMultiplier,e.slot.classList.add("exploding"),e.classList.add("exploding")}),await this.game.delay(350),i.forEach(e=>{e.classList.remove("exploding"),e.promoted=t.default.specials.rainbow,e.futurePromotion=!0})),this.finishExplosion(l)}async explodeRainbow(e,t){const s=[e];s.push(...this.findJewelsByType(t.type)),this.finishExplosion(s)}async explodeMatches(){const e=[];for(let t=this.level.size-1;t>-1;t--)for(let s=0;s<this.level.size;s++){const i=this.findJewelByPosition(s,t);i&&e.push(...this.matchChecker.findPossibleMatches(i))}this.finishExplosion(e)}async finishExplosion(e){0!==e.length&&(this.animating=!0,this.scoreMultiplier++,e.filter(e=>!e.futurePromotion).forEach(e=>{this.game.score+=this.scoreMultiplier,e.slot.classList.add("exploding"),e.classList.add("exploding")}),await this.game.delay(350),e.filter(e=>!e.futurePromotion).forEach(e=>{e.setAttribute("hidden",""),e.classList.remove("exploding")}),await this.moveRows(),await this.fillEmptySlots(!1),await this.explodeMatches(),e.filter(e=>e.futurePromotion).forEach(e=>e.futurePromotion=!1),this.animating=!1)}async moveRows(){const e=[];for(let t=this.level.size-1;t>-1;t--){let s=!1;const i=this.emptySlots.filter(e=>e.y===t);for(let t of i){const i=this.occupiedSlots.filter(t=>-1===e.indexOf(t)).filter(e=>e.x===t.x&&e.y<t.y).sort((e,t)=>t.y-e.y).shift();if(e.push(i),!i||!i.jewel)continue;s=!0,t.classList.remove("exploding"),i.jewel.futureSlot=t,i.jewel.classList.add("moving");const l=i.getBoundingClientRect().height*(t.y-i.y);i.jewel.style.transform=`translate3d(0, ${l}px, 0)`}if(s){await this.game.delay(100);const e=this.jewels.filter(e=>e.classList.contains("moving")).sort((e,t)=>t.y-e.y);for(let t of e){const e=t.slot,s=t.futureSlot,i=s.jewel;e.jewel=i,s.jewel=t,delete t.futureSlot}}}}}exports.default=r,customElements.define("game-board",r);
},{"./Slot":"o0GU","./Jewel":"DQ1O","./MatchChecker":"a9lQ","./MoveChecker":"1wX9"}],"QvaY":[function(require,module,exports) {
"use strict";var e,t=s(require("./Background")),r=s(require("./Board"));function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(0,t.default)(),new(e=class{constructor(){n(this,"levels",[{size:9,specials:{smoke:0,fire:1,star:1,rainbow:0,nebula:0},locks:[{x:2,y:2},{x:6,y:6}]}]),n(this,"_score",0),this.board=new r.default(this),document.querySelector("main").append(this.board),this.board.startLevel(this.levels[0])}delay(e=0,...t){return e?new Promise(r=>setTimeout(r,e,...t)):new Promise(e=>requestAnimationFrame(e))}get score(){return this._score}set score(e){this._score=e,document.getElementById("score").textContent=e}});
},{"./Background":"+sFh","./Board":"Wb9I"}]},{},["QvaY"], null)